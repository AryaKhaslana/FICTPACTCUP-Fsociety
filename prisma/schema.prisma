generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- ENUMS ---
enum Role {
  STUDENT
  UMKM
  ADMIN
}

enum QuestStatus {
  OPEN
  CLOSED
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

// --- MODELS ---
model User {
  id        Int      @id @default(autoincrement())
  username  String
  email     String   @unique
  password  String
  role      Role     @default(STUDENT)
  bio       String?  @db.Text
  avatarUrl String?
  createdAt DateTime @default(now())

  questsCreated    Quest[]           @relation("QuestCreator")
  submissions      Submission[]
  studentProgress  StudentProgress[]
}

model Skill {
  id       Int               @id @default(autoincrement())
  name     String
  iconUrl  String?
  
  quests   Quest[]
  progress StudentProgress[]
}

model StudentProgress {
  id        Int @id @default(autoincrement())
  currentXp Int @default(0)
  level     Int @default(1)

  user    User  @relation(fields: [userId], references: [id])
  userId  Int
  skill   Skill @relation(fields: [skillId], references: [id])
  skillId Int
}

model Quest {
  id          Int         @id @default(autoincrement())
  title       String
  description String      @db.Text
  rewardXp    Int
  status      QuestStatus @default(OPEN)
  createdAt   DateTime    @default(now())

  creator    User   @relation("QuestCreator", fields: [creatorId], references: [id])
  creatorId  Int
  category   Skill  @relation(fields: [categoryId], references: [id])
  categoryId Int
  submissions Submission[]
}

model Submission {
  id          Int              @id @default(autoincrement())
  fileUrl     String
  status      SubmissionStatus @default(PENDING)
  feedback    String?          @db.Text
  submittedAt DateTime         @default(now())

  quest     Quest @relation(fields: [questId], references: [id])
  questId   Int
  student   User  @relation(fields: [studentId], references: [id])
  studentId Int
}